<!doctype html><html lang=zh dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>个人博客小站建设记录 | Woodencross's Cyber Home</title>
<meta name=keywords content="Hugo,Github,Disqus">
<meta name=description content="记录一下自己搭建个人博客的踩坑历程。">
<meta name=author content="Woodencross">
<link rel=canonical href=https://woodencross.github.io/posts/blog-building-record/>
<meta name=google-site-verification content="XYZabc">
<meta name=yandex-verification content="XYZabc">
<meta name=msvalidate.01 content="XYZabc">
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://woodencross.github.io/%3Clink%20/%20abs%20url%3E>
<link rel=icon type=image/png sizes=16x16 href=https://woodencross.github.io/%3Clink%20/%20abs%20url%3E>
<link rel=icon type=image/png sizes=32x32 href=https://woodencross.github.io/%3Clink%20/%20abs%20url%3E>
<link rel=apple-touch-icon href=https://woodencross.github.io/%3Clink%20/%20abs%20url%3E>
<link rel=mask-icon href=https://woodencross.github.io/%3Clink%20/%20abs%20url%3E>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.91.2">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-123-45','auto'),ga('send','pageview'))</script><meta property="og:title" content="个人博客小站建设记录">
<meta property="og:description" content="记录一下自己搭建个人博客的踩坑历程。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://woodencross.github.io/posts/blog-building-record/"><meta property="og:image" content="https://woodencross.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-12-21T23:13:20+08:00">
<meta property="article:modified_time" content="2021-12-25T17:52:39+08:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://woodencross.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E">
<meta name=twitter:title content="个人博客小站建设记录">
<meta name=twitter:description content="记录一下自己搭建个人博客的踩坑历程。">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"文章","item":"https://woodencross.github.io/posts/"},{"@type":"ListItem","position":2,"name":"个人博客小站建设记录","item":"https://woodencross.github.io/posts/blog-building-record/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"个人博客小站建设记录","name":"个人博客小站建设记录","description":"记录一下自己搭建个人博客的踩坑历程。","keywords":["Hugo","Github","Disqus"],"articleBody":"为什么想建个人博客 一个重要的原因是因为想有一个地方可以自己记录一些东西，而各种现成的平台一是觉得自定义程度不够高，二是内容又会经过层层审核甚至被夹掉，所以到最后就选择了自建一个博客小站。看着小站在自己手中逐渐完善，就好像自己逐渐装修起来一个精致舒适的小屋一样，会真正有一种“属于我”的归属感，这也是这个小站叫做“Woodencross’s Cyber Home”的原因。寄蜉蝣于天地，渺沧海之一粟，希望这个小站能够成为QC在赛博空间里的“锚”。\n当然还有一个原因是忙完前一段突然得了点闲，就想折腾了😅。\nHugo\u0026Github Pages 自建博客当然要先选择一个框架啦，于是Google了一下目前主流的博客框架，再上Github看了一下⭐，Hugo的星最多，那么就决定是你了！\n至于Github Pages，白嫖嘛，多是一件美事啊。\n踩坑经历 框架问题 Todo: config.yaml与content/\n图片插入问题 由于编译静态网站后文件结构不同，因此在文章的.md中使用相对路径插入图片是行不通的，如下：\nposts |-article |-article.md |-img.png 此时在article.md中使用![](./img.png)引用图片会404。\n那么正确的图片引用姿势有这几种：\n  使用图床，然后引用图片网址。这样的风险就是万一图床挂了或者网址变动就全完了。\n  使用绝对路径。Hugo在构建静态网页时会将content/下的文件夹和static文件本身都拷贝到网址之下（应该是基于设定的baseUrl？），所以如果图片是这样放的：\nposts |-article |-article.md |-img.png 那么在article.md中可以使用![](/post/article/img.png)来引用图片。\n如果图片是这样放的：\nstatic |-images |-img.png 那么在article.md中可以使用![](/images/img.png)来引用图片。\n  不过在这个动荡的时代，资源还是自己掌握最好哇！说到这我又想起来以后自己搞一个家用NAS的Flag，想必又是一个大坑……\n顺便一提，如果要调整插入图片的位置和大小的话，markdown自身语法支持并不好，而使用html的话Hugo好像支持也不太完善，因此使用Hugo提供的Shortcodes是一个不错的选择，回头专开一章写一写（挖坑不填警告）。\n代码高亮问题 Hugo提供了Shortcodes支持代码块高亮，但是Shortcodes我还没搞明白……\n万幸的是，Hugo从v0.60.0开始支持如下写法：\n1 2 3  ```python {linenos=true, hl_lines=[1, \"15-17\"], linenostart=199} //code ```   这种写法好像只有goldmark渲染器支持。解释一下大括号中的元素：\n linenos：布尔值，是否显示行号。 hl_lines：需要高亮渲染的行号。 linenostart：行号开始显示的值。  搜索问题 PaperMod主题内置了Fuse.js搜索功能，首先需要在config.yaml加入：\n1 2 3 4 5  outputs: home: - HTML - RSS - JSON # is necessary   之后需要在content/下新建一个search.md（我的是search/_index.md），表示一个新页面，并添加如下内容：\n1 2 3 4 5 6 7  --- title: \"Search\" # in any language you want layout: \"search\" # is necessary # url: \"/archive\" # description: \"Description for Search\" summary: \"search\" ---   其中layout: \"search\"是必要的，它指定了要以“search”的页面结构来渲染这一页。\n其实主题作者基本把搜索都给弄好了，但是我一开始傻傻地把.yaml里要加代码的位置搞错了，把outputs加到了param参数下，人家应该在根下自成一个参数的。因此搜索不好使，我还把搜索页面的描述改成了“随时失灵……”。\n分享按钮问题 一开始每篇文章最下面都会有一行分享按钮，我觉得不好看而且实用性不高（都是些Twitter、Facebook啥的），就想给它禁用掉。为此经历了三个阶段：\n 在项目内搜索twitter.com，发现themes/PaperMod/layouts/partials/share_icons.html包含这一字段，于是新建layouts/partials/share_icons.html并置为空文件，这样可以覆盖主题里的对应文件。为防止误删我还特意写了一段注释（# 不要删除这段空循环否则后果自负.jpg）。 可是马上我就发现，可以通过在文章.md的front matter（即前缀）中声明disableShare: true来禁用当前页面的分享按钮，于是我把第一步的空文件删掉，给目前的每篇文章都加上这个声明，并且给archetypes/default.md里也加了一下。这个文件是每次运行Hugo new新建文章时的模板，这样我的新文章也都能不显示分享了。 一天后，我在翻阅config.yaml时发现一行 ShowShareButtons: true 啊这，难道是【那个功能】！改成false试了一下果然……  大概这就是“认识的波浪式前进与螺旋式上升吧”。\n评论问题 Disqus Hogo对评论的支持与主题有关。我用的PaperMod虽然没有内置主题，但是它留下了自定义的接口，既然有接口那可不能浪费了啊。\n首先按照PaperMod主题的文档新建一个layouts/partials/comments.html文件，还要修改config.yaml：\n1 2  params: comments: true   接着按照Hugo的文档去注册一个Disqus账号获得disqus-short-name，这是什么呢？原来Disqus会对我登记的每一个站点生成一个disqus-short-name.disqus.com的管理页面，这个short name就是里面的三级域名，当然这是可以在登记网站时自定义的。\n获得short name之后，需要回config.yaml中把它记下来：\n1  disqusShortname: disqus-short-name   之后再根据Hugo官方的这个文档，复制里面的layouts/partials/disqus.html到我前面创建的comments.html里（不能改名，这个文件会按名字在layouts/_default/single.html中被调用渲染），之后注释掉里面检测localhost的if语句，就可以本地调试看到评论区出现啦。\nPS：disqus.html的内容在Disqus的上手文档里也有提供，好像叫做Universal Code，两者大差不差，区别就是Hugo的代码调用了.Site.DisqusShortname来获取short name而Disqus的代码是直接把short name写在链接里了。\n为了防止评论出bug，我还配置了一下disqus_identifier和disqus_url，具体是在comments.html中script一开始加入代码：\n1 2 3 4 5  var disqus_config = function() { this.page.title = '{{ .Title }}'; this.page.url = '{{ .Permalink }}'; this.page.identifier = '{{ .Permalink }}'; };   不过效果如何还有待验证，也可能就是个安慰剂，反正有备无患嘛。\n还有，Disqus默认的评论区总感觉有种湾湾风格不知道为啥……回头看看能不能美化一点，或者看别人用的Waline挺好看的说不定换一下。\nGitalk Push到网站上后才发现Disqus在国内被墙了，还是换一个吧……先试试Gitalk，这是一个基于Github issue的评论服务，正好可以使用网站的公开仓库issue存放评论，官方文档在这里，但是对我来说写的不够傻瓜，于是又在别人的博客上找到了这个。\n设置步骤如下：\n 在GithubSettings-Developer settings-OAuth Apps中新建一个授权，其中Homepage URL和Authorization callback URL都填主页的地址，并记住生成的clientID和clientSecret。 更改comments.html为 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  div id=\"gitalk-container\"div link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css\" script src=\"https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js\"script script const gitalk = new Gitalk({ clientID: '{{ .Site.Params.Gitalk.clientID }}', clientSecret: '{{ .Site.Params.Gitalk.clientSecret }}', repo: '{{ .Site.Params.Gitalk.repo }}', owner: '{{ .Site.Params.Gitalk.owner }}', admin: ['{{ .Site.Params.Gitalk.owner }}'], id: location.pathname, // Ensure uniqueness and length less than 50  distractionFreeMode: false // Facebook-like distraction free mode  }); (function() { if ([\"localhost\", \"127.0.0.1\"].indexOf(window.location.hostname) != -1) { document.getElementById('gitalk-container').innerHTML = 'Gitalk comments not available by default when the website is previewed locally.'; return; } gitalk.render('gitalk-container'); })(); script    在config.yaml中加入相关参数： 1 2 3 4 5 6 7  params: Gitalk: clientID: your clientID clientSecret: your clientSecret repo: \"Woodencross.github.io\" owner: \"Woodencross\" admin: [\"Woodencross\"]   并设置 comments: true   设置好之后，本地调试的话需要把检测localhost的代码删掉。建议是push到网站上再调试，因为评论需要登陆Github账号。Gitalk会给每一篇文章新建一个issue来存放评论，初始化时需要身份为admin的用户打开文章评论区才会自动新建一个issue。\n效果如下：\n 与主题契合的挺好！美中不足的就是在暗色模式下评论依旧是亮色，有些违和：\n 只能说还是不够好呀。\nWaline  同时 @waline/client 还带来了内置的暗黑模式支持。——Waline\n 于是我又来折腾辣。官方手册在此，这个写的很傻瓜基本上照做就没啥问题。\n结束后我的comments.html是这样的：\n1 2 3 4 5 6 7 8  script src=\"//cdn.jsdelivr.net/npm/@waline/client\"script div id=\"waline-container\"div script Waline({ el: '#waline-container', serverURL: 'my server URL', }); script   但是在网站暗色模式下依旧是亮色\n 于是来看手册：\n 通常网站会通过两种方式启用暗黑模式支持:\n 使用@media选择器通过prefers-color-scheme来根据设备颜色模式状态自动切换 通过修改dom根元素(html或body)的属性与class来动态应用或取消暗黑模式的颜色样式。 如果你在第一种方式的站点上启用Waline，你只需将dark设置为’auto'。 对于第二种站点，你需要将dark设置为令暗黑模式生效的CSS选择器。   首先尝试在Waline()中添加\ndark: 'auto' 发现无效，说明我的网站应该是第二种情况，那就是说要填一个CSS选择器的名字？继续看手册的例子：\n vuepress-theme-hope: 它会在上添加theme-dark class来开启暗黑模式。那么你需要将dark选项设置为body.theme-dark。\n 在上添加？依照我贫瘠的html知识的指引，我打开了f12开发者模式，并尝试切换主题：\n 亮色\n   暗色\n  我超，还真有。于是添加\ndark: 'body.dark'  大功告成！心里终于舒坦了~而且Waline还支持表情，感觉挺不赖，就先用着它了。\n","wordCount":"3884","inLanguage":"zh","datePublished":"2021-12-21T23:13:20+08:00","dateModified":"2021-12-25T17:52:39+08:00","author":{"@type":"Person","name":"Woodencross"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://woodencross.github.io/posts/blog-building-record/"},"publisher":{"@type":"Organization","name":"Woodencross's Cyber Home","logo":{"@type":"ImageObject","url":"https://woodencross.github.io/%3Clink%20/%20abs%20url%3E"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://woodencross.github.io/ accesskey=h title="Woodencross's Cyber Home (Alt + H)">Woodencross's Cyber Home</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://woodencross.github.io/posts/ title=文章>
<span>文章</span>
</a>
</li>
<li>
<a href=https://woodencross.github.io/categories/ title=分类>
<span>分类</span>
</a>
</li>
<li>
<a href=https://woodencross.github.io/archives/ title=归档>
<span>归档</span>
</a>
</li>
<li>
<a href=https://woodencross.github.io/tags/ title=标签>
<span>标签</span>
</a>
</li>
<li>
<a href=https://woodencross.github.io/search/ title="搜索 (Alt + /)" accesskey=/>
<span>搜索</span>
</a>
</li>
<li>
<a href=https://woodencross.github.io/about/ title=关于>
<span>关于</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://woodencross.github.io/>主页</a>&nbsp;»&nbsp;<a href=https://woodencross.github.io/posts/>文章</a></div>
<h1 class=post-title>
个人博客小站建设记录<sup><span class=entry-isdraft>&nbsp;&nbsp;[draft]</span></sup>
</h1>
<div class=post-description>
记录一下自己搭建个人博客的踩坑历程。
</div>
<div class=post-meta><span title="2021-12-21 23:13:20 +0800 +0800">December 21, 2021</span>&nbsp;·&nbsp;8 分钟&nbsp;·&nbsp;Woodencross
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>目录</span>
</summary>
<div class=inner><ul>
<li>
<a href=#%e4%b8%ba%e4%bb%80%e4%b9%88%e6%83%b3%e5%bb%ba%e4%b8%aa%e4%ba%ba%e5%8d%9a%e5%ae%a2 aria-label=为什么想建个人博客>为什么想建个人博客</a></li>
<li>
<a href=#hugogithub-pages aria-label="Hugo&amp;amp;Github Pages">Hugo&Github Pages</a></li>
<li>
<a href=#%e8%b8%a9%e5%9d%91%e7%bb%8f%e5%8e%86 aria-label=踩坑经历>踩坑经历</a><ul>
<li>
<a href=#%e6%a1%86%e6%9e%b6%e9%97%ae%e9%a2%98 aria-label=框架问题>框架问题</a></li>
<li>
<a href=#%e5%9b%be%e7%89%87%e6%8f%92%e5%85%a5%e9%97%ae%e9%a2%98 aria-label=图片插入问题>图片插入问题</a></li>
<li>
<a href=#%e4%bb%a3%e7%a0%81%e9%ab%98%e4%ba%ae%e9%97%ae%e9%a2%98 aria-label=代码高亮问题>代码高亮问题</a></li>
<li>
<a href=#%e6%90%9c%e7%b4%a2%e9%97%ae%e9%a2%98 aria-label=搜索问题>搜索问题</a></li>
<li>
<a href=#%e5%88%86%e4%ba%ab%e6%8c%89%e9%92%ae%e9%97%ae%e9%a2%98 aria-label=分享按钮问题>分享按钮问题</a></li>
<li>
<a href=#%e8%af%84%e8%ae%ba%e9%97%ae%e9%a2%98 aria-label=评论问题>评论问题</a><ul>
<li>
<a href=#disqus aria-label=Disqus>Disqus</a></li>
<li>
<a href=#gitalk aria-label=Gitalk>Gitalk</a></li>
<li>
<a href=#waline aria-label=Waline>Waline</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h2 id=为什么想建个人博客>为什么想建个人博客<a hidden class=anchor aria-hidden=true href=#为什么想建个人博客>#</a></h2>
<p>一个重要的原因是因为想有一个地方可以自己记录一些东西，而各种现成的平台一是觉得自定义程度不够高，二是内容又会经过层层审核甚至被夹掉，所以到最后就选择了自建一个博客小站。看着小站在自己手中逐渐完善，就好像自己逐渐装修起来一个精致舒适的小屋一样，会真正有一种“属于我”的归属感，这也是这个小站叫做“Woodencross&rsquo;s Cyber <strong>Home</strong>”的原因。寄蜉蝣于天地，渺沧海之一粟，希望这个小站能够成为QC在赛博空间里的“锚”。</p>
<p>当然还有一个原因是忙完前一段突然得了点闲，就想折腾了😅。</p>
<h2 id=hugogithub-pages>Hugo&Github Pages<a hidden class=anchor aria-hidden=true href=#hugogithub-pages>#</a></h2>
<p>自建博客当然要先选择一个框架啦，于是Google了一下目前主流的博客框架，再上Github看了一下⭐，Hugo的星最多，那么就决定是你了！</p>
<p>至于Github Pages，白嫖嘛，多是一件美事啊。</p>
<h2 id=踩坑经历>踩坑经历<a hidden class=anchor aria-hidden=true href=#踩坑经历>#</a></h2>
<h3 id=框架问题>框架问题<a hidden class=anchor aria-hidden=true href=#框架问题>#</a></h3>
<p><em>Todo: config.yaml与content/</em></p>
<h3 id=图片插入问题>图片插入问题<a hidden class=anchor aria-hidden=true href=#图片插入问题>#</a></h3>
<p>由于编译静态网站后文件结构不同，因此在文章的<code>.md</code>中使用相对路径插入图片是行不通的，如下：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext>posts
    |-article
        |-article.md
        |-img.png
</code></pre></div><p>此时在<code>article.md</code>中使用<code>![](./img.png)</code>引用图片会404。</p>
<p>那么正确的图片引用姿势有这几种：</p>
<ol>
<li>
<p>使用图床，然后引用图片网址。这样的风险就是万一图床挂了或者网址变动就全完了。</p>
</li>
<li>
<p>使用绝对路径。Hugo在构建静态网页时会将<code>content/</code>下的文件夹和<code>static</code>文件本身都拷贝到网址之下（应该是基于设定的<code>baseUrl</code>？），所以如果图片是这样放的：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext>posts
    |-article
        |-article.md
        |-img.png
</code></pre></div><p>那么在<code>article.md</code>中可以使用<code>![](/post/article/img.png)</code>来引用图片。</p>
<p>如果图片是这样放的：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext>static
    |-images
        |-img.png
</code></pre></div><p>那么在<code>article.md</code>中可以使用<code>![](/images/img.png)</code>来引用图片。</p>
</li>
</ol>
<p>不过在这个<del>动荡的</del>时代，资源还是自己掌握最好哇！说到这我又想起来以后自己搞一个家用NAS的Flag，想必又是一个大坑……</p>
<p>顺便一提，如果要调整插入图片的位置和大小的话，markdown自身语法支持并不好，而使用html的话Hugo好像支持也不太完善，因此使用Hugo提供的Shortcodes是一个不错的选择，回头专开一章写一写（挖坑不填警告）。</p>
<h3 id=代码高亮问题>代码高亮问题<a hidden class=anchor aria-hidden=true href=#代码高亮问题>#</a></h3>
<p>Hugo提供了Shortcodes支持<a href=https://gohugo.io/content-management/syntax-highlighting/>代码块高亮</a>，但是Shortcodes我还没搞明白……</p>
<p>万幸的是，Hugo从v0.60.0开始支持如下写法：</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext>    ```python {linenos=true, hl_lines=[1, &#34;15-17&#34;], linenostart=199}
    //code
    ```
</code></pre></td></tr></table>
</div>
</div><p>这种写法好像只有goldmark渲染器支持。解释一下大括号中的元素：</p>
<ul>
<li><code>linenos</code>：布尔值，是否显示行号。</li>
<li><code>hl_lines</code>：需要高亮渲染的行号。</li>
<li><code>linenostart</code>：行号开始显示的值。</li>
</ul>
<h3 id=搜索问题>搜索问题<a hidden class=anchor aria-hidden=true href=#搜索问题>#</a></h3>
<p><a href=https://adityatelange.github.io/hugo-PaperMod/posts/papermod/papermod-features/#search-page>PaperMod主题内置了Fuse.js搜索功能</a>，首先需要在<code>config.yaml</code>加入：</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>outputs</span>:
    <span style=color:#f92672>home</span>:
        - <span style=color:#ae81ff>HTML</span>
        - <span style=color:#ae81ff>RSS</span>
        - <span style=color:#ae81ff>JSON</span> <span style=color:#75715e># is necessary</span>
</code></pre></td></tr></table>
</div>
</div><p>之后需要在<code>content/</code>下新建一个<code>search.md</code>（我的是<code>search/_index.md</code>），表示一个新页面，并添加如下内容：</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>---
<span style=color:#f92672>title</span>: <span style=color:#e6db74>&#34;Search&#34;</span> <span style=color:#75715e># in any language you want</span>
<span style=color:#f92672>layout</span>: <span style=color:#e6db74>&#34;search&#34;</span> <span style=color:#75715e># is necessary</span>
<span style=color:#75715e># url: &#34;/archive&#34;</span>
<span style=color:#75715e># description: &#34;Description for Search&#34;</span>
<span style=color:#f92672>summary</span>: <span style=color:#e6db74>&#34;search&#34;</span>
---
</code></pre></td></tr></table>
</div>
</div><p>其中<code>layout: "search"</code>是必要的，它指定了要以“search”的页面结构来渲染这一页。</p>
<p>其实主题作者基本把搜索都给弄好了，但是我一开始傻傻地把<code>.yaml</code>里要加代码的位置搞错了，把<code>outputs</code>加到了<code>param</code>参数下，人家应该在根下自成一个参数的。因此搜索不好使，我还把搜索页面的描述改成了“随时失灵……”。</p>
<h3 id=分享按钮问题>分享按钮问题<a hidden class=anchor aria-hidden=true href=#分享按钮问题>#</a></h3>
<p>一开始每篇文章最下面都会有一行分享按钮，我觉得不好看而且实用性不高（都是些Twitter、Facebook啥的），就想给它禁用掉。为此经历了三个阶段：</p>
<ol>
<li>在项目内搜索<code>twitter.com</code>，发现<code>themes/PaperMod/layouts/partials/share_icons.html</code>包含这一字段，于是新建<code>layouts/partials/share_icons.html</code>并置为空文件，这样可以覆盖主题里的对应文件。为防止误删我还特意写了一段注释（# 不要删除这段空循环否则后果自负.jpg）。</li>
<li>可是马上我就发现，可以通过在文章<code>.md</code>的front matter（即前缀）中声明<code>disableShare: true</code>来禁用当前页面的分享按钮，于是我把第一步的空文件删掉，给目前的每篇文章都加上这个声明，并且给<code>archetypes/default.md</code>里也加了一下。这个文件是每次运行<code>Hugo new</code>新建文章时的模板，这样我的新文章也都能不显示分享了。</li>
<li>一天后，我在翻阅<code>config.yaml</code>时发现一行
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>ShowShareButtons</span>: <span style=color:#66d9ef>true</span>
</code></pre></div>啊这，难道是【那个功能】！改成false试了一下果然……</li>
</ol>
<p>大概这就是“认识的波浪式前进与螺旋式上升吧”。</p>
<h3 id=评论问题>评论问题<a hidden class=anchor aria-hidden=true href=#评论问题>#</a></h3>
<h4 id=disqus>Disqus<a hidden class=anchor aria-hidden=true href=#disqus>#</a></h4>
<p>Hogo对评论的支持与主题有关。我用的PaperMod虽然没有内置主题，但是它留下了自定义的接口，既然有接口那可不能浪费了啊。</p>
<p>首先按照PaperMod主题的<a href=https://adityatelange.github.io/hugo-PaperMod/posts/papermod/papermod-features/#comments>文档</a>新建一个<code>layouts/partials/comments.html</code>文件，还要修改<code>config.yaml</code>：</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>params</span>:
    <span style=color:#f92672>comments</span>: <span style=color:#66d9ef>true</span>
</code></pre></td></tr></table>
</div>
</div><p>接着按照Hugo的<a href=https://gohugo.io/content-management/comments/>文档</a>去注册一个Disqus账号获得disqus-short-name，这是什么呢？原来Disqus会对我登记的每一个站点生成一个<code>disqus-short-name.disqus.com</code>的管理页面，这个short name就是里面的三级域名，当然这是可以在登记网站时自定义的。</p>
<p>获得short name之后，需要回<code>config.yaml</code>中把它记下来：</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>disqusShortname</span>: <span style=color:#ae81ff>disqus-short-name</span>
</code></pre></td></tr></table>
</div>
</div><p>之后再根据Hugo官方的<a href=https://gohugo.io/templates/internal/#disqus>这个文档</a>，复制里面的<code>layouts/partials/disqus.html</code>到我前面创建的<code>comments.html</code>里（不能改名，这个文件会按名字在<code>layouts/_default/single.html</code>中被调用渲染），之后注释掉里面检测localhost的if语句，就可以本地调试看到评论区出现啦。</p>
<p>PS：<code>disqus.html</code>的内容在Disqus的上手文档里也有提供，好像叫做Universal Code，两者大差不差，区别就是Hugo的代码调用了<code>.Site.DisqusShortname</code>来获取short name而Disqus的代码是直接把short name写在链接里了。</p>
<p>为了防止评论出bug，我还配置了一下<code>disqus_identifier</code>和<code>disqus_url</code>，具体是在<code>comments.html</code>中<code>script</code>一开始加入代码：</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>var disqus_config = function() {
    this.page.title = &#39;{{ .Title }}&#39;;
    this.page.url = &#39;{{ .Permalink }}&#39;;
    this.page.identifier = &#39;{{ .Permalink }}&#39;;
};
</code></pre></td></tr></table>
</div>
</div><p>不过效果如何还有待验证，也可能就是个安慰剂，反正有备无患嘛。</p>
<p>还有，Disqus默认的评论区总感觉有种湾湾风格不知道为啥……回头看看能不能美化一点，或者看别人用的<a href=https://waline.js.org/>Waline</a>挺好看的说不定换一下。</p>
<h4 id=gitalk>Gitalk<a hidden class=anchor aria-hidden=true href=#gitalk>#</a></h4>
<p>Push到网站上后才发现Disqus在国内被墙了，还是换一个吧……先试试Gitalk，这是一个基于Github issue的评论服务，正好可以使用网站的公开仓库issue存放评论，官方文档在<a href=https://github.com/gitalk/gitalk/blob/master/readme-cn.md>这里</a>，但是对我来说写的不够傻瓜，于是又在别人的博客上找到了<a href=https://charmerkai.github.io/posts/2020-11/%E7%BB%99hugo%E5%8A%A0%E5%85%A5gitalk/>这个</a>。</p>
<p>设置步骤如下：</p>
<ol>
<li>在Github<code>Settings->Developer settings->OAuth Apps</code>中新建一个授权，其中<code>Homepage URL</code>和<code>Authorization callback URL</code>都填主页的地址，并记住生成的<code>clientID</code>和<code>clientSecret</code>。</li>
<li>更改<code>comments.html</code>为
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html> &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;gitalk-container&#34;</span>&gt;&lt;/<span style=color:#f92672>div</span>&gt;
 &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css&#34;</span>&gt;
 &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
 &lt;<span style=color:#f92672>script</span>&gt;
   <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>gitalk</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Gitalk</span>({
     <span style=color:#a6e22e>clientID</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;{{ .Site.Params.Gitalk.clientID }}&#39;</span>,
     <span style=color:#a6e22e>clientSecret</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;{{ .Site.Params.Gitalk.clientSecret }}&#39;</span>,
     <span style=color:#a6e22e>repo</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;{{ .Site.Params.Gitalk.repo }}&#39;</span>,
     <span style=color:#a6e22e>owner</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;{{ .Site.Params.Gitalk.owner }}&#39;</span>,
     <span style=color:#a6e22e>admin</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;{{ .Site.Params.Gitalk.owner }}&#39;</span>],
     <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>location</span>.<span style=color:#a6e22e>pathname</span>, <span style=color:#75715e>// Ensure uniqueness and length less than 50
</span><span style=color:#75715e></span>     <span style=color:#a6e22e>distractionFreeMode</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span> <span style=color:#75715e>// Facebook-like distraction free mode
</span><span style=color:#75715e></span>   });
   (<span style=color:#66d9ef>function</span>() {
     <span style=color:#66d9ef>if</span> ([<span style=color:#e6db74>&#34;localhost&#34;</span>, <span style=color:#e6db74>&#34;127.0.0.1&#34;</span>].<span style=color:#a6e22e>indexOf</span>(window.<span style=color:#a6e22e>location</span>.<span style=color:#a6e22e>hostname</span>) <span style=color:#f92672>!=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) {
       document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;gitalk-container&#39;</span>).<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Gitalk comments not available by default when the website is previewed locally.&#39;</span>;
       <span style=color:#66d9ef>return</span>;
     }
     <span style=color:#a6e22e>gitalk</span>.<span style=color:#a6e22e>render</span>(<span style=color:#e6db74>&#39;gitalk-container&#39;</span>);
   })();
 &lt;/<span style=color:#f92672>script</span>&gt;
</code></pre></td></tr></table>
</div>
</div></li>
<li>在<code>config.yaml</code>中加入相关参数：
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml> <span style=color:#f92672>params</span>:
   <span style=color:#f92672>Gitalk</span>:
     <span style=color:#f92672>clientID</span>: <span style=color:#ae81ff>your clientID</span>
     <span style=color:#f92672>clientSecret</span>: <span style=color:#ae81ff>your clientSecret</span>
     <span style=color:#f92672>repo</span>: <span style=color:#e6db74>&#34;Woodencross.github.io&#34;</span>
     <span style=color:#f92672>owner</span>: <span style=color:#e6db74>&#34;Woodencross&#34;</span>
     <span style=color:#f92672>admin</span>: [<span style=color:#e6db74>&#34;Woodencross&#34;</span>]
</code></pre></td></tr></table>
</div>
</div>并设置
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml> <span style=color:#f92672>comments</span>: <span style=color:#66d9ef>true</span>
</code></pre></div></li>
</ol>
<p>设置好之后，本地调试的话需要把检测localhost的代码删掉。建议是push到网站上再调试，因为评论需要登陆Github账号。Gitalk会给每一篇文章新建一个issue来存放评论，初始化时需要身份为admin的用户打开文章评论区才会自动新建一个issue。</p>
<p>效果如下：</p>
<figure class=align-center>
<img loading=lazy src=/images/screenshots/Gitalk%e4%ba%ae.png#center>
</figure>
<p>与主题契合的挺好！美中不足的就是在暗色模式下评论依旧是亮色，有些违和：</p>
<figure class=align-center>
<img loading=lazy src=/images/screenshots/Gitalk%e6%9a%97.png#center>
</figure>
<p>只能说还是不够好呀。</p>
<h4 id=waline>Waline<a hidden class=anchor aria-hidden=true href=#waline>#</a></h4>
<blockquote>
<p>同时 @waline/client 还带来了内置的暗黑模式支持。——Waline</p>
</blockquote>
<p>于是我又来折腾辣。官方手册<a href=https://waline.js.org/guide/get-started.html>在此</a>，这个写的很傻瓜基本上照做就没啥问题。</p>
<p>结束后我的<code>comments.html</code>是这样的：</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;//cdn.jsdelivr.net/npm/@waline/client&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
&lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;waline-container&#34;</span>&gt;&lt;/<span style=color:#f92672>div</span>&gt;
&lt;<span style=color:#f92672>script</span>&gt;
    <span style=color:#a6e22e>Waline</span>({
      <span style=color:#a6e22e>el</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;#waline-container&#39;</span>,
      <span style=color:#a6e22e>serverURL</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;my server URL&#39;</span>,
    });
&lt;/<span style=color:#f92672>script</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>但是在网站暗色模式下依旧是亮色</p>
<figure class=align-center>
<img loading=lazy src=/images/screenshots/Waline%e4%ba%ae.png#center>
</figure>
<p>于是来看手册：</p>
<blockquote>
<p>通常网站会通过两种方式启用暗黑模式支持:</p>
<ul>
<li>使用@media选择器通过prefers-color-scheme来根据设备颜色模式状态自动切换</li>
<li>通过修改dom根元素(html或body)的属性与class来动态应用或取消暗黑模式的颜色样式。
如果你在第一种方式的站点上启用Waline，你只需将dark设置为&rsquo;auto'。
对于第二种站点，你需要将dark设置为令暗黑模式生效的CSS选择器。</li>
</ul>
</blockquote>
<p>首先尝试在Waline()中添加</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>dark: &#39;auto&#39;
</code></pre></div><p>发现无效，说明我的网站应该是第二种情况，那就是说要填一个CSS选择器的名字？继续看手册的例子：</p>
<blockquote>
<p>vuepress-theme-hope: 它会在<code>&lt;body></code>上添加theme-dark class来开启暗黑模式。那么你需要将dark选项设置为body.theme-dark。</p>
</blockquote>
<p>在<code>&lt;body></code>上添加？依照我贫瘠的html知识的指引，我打开了f12开发者模式，并尝试切换主题：</p>
<figure class=align-center>
<img loading=lazy src=/images/screenshots/body%e4%ba%ae.png#center alt=亮色> <figcaption>
<p>亮色</p>
</figcaption>
</figure>
<figure class=align-center>
<img loading=lazy src=/images/screenshots/body%e6%9a%97.png#center alt=暗色> <figcaption>
<p>暗色</p>
</figcaption>
</figure>
<p>我超，还真有。于是添加</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>dark: &#39;body.dark&#39;
</code></pre></div><figure class=align-center>
<img loading=lazy src=/images/screenshots/Waline%e6%9a%97.png#center>
</figure>
<p>大功告成！心里终于舒坦了~而且Waline还支持表情，感觉挺不赖，就先用着它了。</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://woodencross.github.io/tags/hugo/>Hugo</a></li>
<li><a href=https://woodencross.github.io/tags/github/>Github</a></li>
<li><a href=https://woodencross.github.io/tags/disqus/>Disqus</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://woodencross.github.io/posts/linux-manjaro-record/>
<span class=title>« 上一页</span>
<br>
<span>Linux/Manjaro 折腾记录</span>
</a>
<a class=next href=https://woodencross.github.io/posts/my-first-post/>
<span class=title>下一页 »</span>
<br>
<span>第一篇博客？</span>
</a>
</nav>
</footer><script src=//cdn.jsdelivr.net/npm/@waline/client></script>
<div id=waline-container></div>
<script>const locale={};Waline({el:'#waline-container',serverURL:'https://waline4myblog-897ihl1ou-woodencross.vercel.app/',dark:'body.dark',visitor:!0,avatar:'retro',emoji:['https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/weibo','https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/tieba','https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/bilibili'],locale})</script>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://woodencross.github.io/>Woodencross's Cyber Home</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='复制';function d(){a.innerText='已复制！',setTimeout(()=>{a.innerText='复制'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>